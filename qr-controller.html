<!DOCTYPE html>
<html>
  <head>
    <title>Coyote Controller</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
      }
      button {
        margin: 5px;
        padding: 10px 20px;
      }
      input[type="range"] {
        width: 80%;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ§  Coyote V3 Controller</h1>
    <canvas id="qrcode"></canvas>
    <p><strong>Verbinde Ã¼ber App & nutze die Steuerelemente unten</strong></p>

    <hr />

    <label
      >Kanal:
      <select id="channel">
        <option value="0">0</option>
        <option value="1">1</option>
      </select> </label
    ><br /><br />

    <label
      >Modus:
      <select id="mode">
        <option value="0">0 (Pulse)</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select> </label
    ><br /><br />

    <label
      >StÃ¤rke:
      <input type="range" min="0" max="10" value="5" id="strength" />
    </label>
    <span id="strengthVal">5</span><br /><br />

    <button onclick="send()">âž¤ Senden</button>

    <script type="module">
      import { connectionId, ws } from "./wsConnection.js";

      const prefix =
        "https://www.dungeon-lab.com/app-download.php#DGLAB-SOCKET#";
      const qrData =
        prefix + `wss://coyote-ws-server.onrender.com/${connectionId}`;
      QRCode.toCanvas(
        document.getElementById("qrcode"),
        qrData,
        function (err) {
          if (err) console.error(err);
          else console.log("âœ… QR-Code generiert");
        }
      );

      const strengthSlider = document.getElementById("strength");
      const strengthLabel = document.getElementById("strengthVal");
      strengthSlider.oninput = () => {
        strengthLabel.textContent = strengthSlider.value;
      };

      window.send = function () {
        const message = {
          type: "msg",
          clientId: connectionId,
          targetId: "", // wird vom Server via Bind ersetzt
          message:
            "strength-0+" +
            document.getElementById("channel").value +
            "+" +
            document.getElementById("mode").value +
            "+" +
            document.getElementById("strength").value,
        };

        console.log("ðŸ“¤ Sende Nachricht:", message);
        ws.send(JSON.stringify(message));
      };
    </script>
  </body>
</html>
